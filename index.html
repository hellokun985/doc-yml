<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>configs/ (YAML)</title>
  <style>
    :root {
      --text: #111;
      --muted: #667085;
      --border: #e5e7eb;
      --bg: #ffffff;
      --bg2: #fafafa;
      --link: #0b57d0;
    }

    body {
      max-width: 980px;
      margin: 40px auto;
      padding: 0 16px 56px;
      font: 14px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background: var(--bg);
    }

    .top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
      padding-bottom: 14px;
      border-bottom: 1px solid var(--border);
    }

    .brand {
      display: grid;
      gap: 6px;
    }

    .brand h1 {
      font-size: 22px;
      line-height: 1.25;
      margin: 0;
      letter-spacing: 0.2px;
    }

    .brand .sub {
      color: var(--muted);
      font-size: 13px;
    }

    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: flex-end;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--bg2);
      color: var(--text);
      text-decoration: none;
      font-size: 13px;
      white-space: nowrap;
    }

    .btn:hover { border-color: #d1d5db; }

    .meta {
      color: var(--muted);
    }

    .statusline {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin: 10px 0 12px;
    }

    input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      margin: 14px 0 10px;
      background: var(--bg);
      outline: none;
    }

    input:focus { border-color: #c7d2fe; box-shadow: 0 0 0 3px rgba(99,102,241,.15); }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      background: var(--bg);
    }

    thead th {
      background: var(--bg2);
      color: var(--muted);
      font-weight: 600;
      font-size: 12px;
      text-transform: none;
      letter-spacing: .2px;
    }

    th, td {
      text-align: left;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
    }

    tbody tr:last-child td { border-bottom: none; }

    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }

    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
    }

    .pill {
      display: inline-block;
      padding: 3px 9px;
      border: 1px solid var(--border);
      border-radius: 999px;
      color: #344054;
      background: var(--bg2);
      font-size: 12px;
    }

    footer {
      margin-top: 16px;
      color: var(--muted);
      font-size: 12px;
    }
  </style>
</head>
<body>
  <header class="top">
    <div class="brand">
      <h1>个人托管文档</h1>
      <div class="sub">托管 YAML 配置文件（支持子目录） · 提供 Pages/Raw/Edit 快捷链接</div>
    </div>
    <div class="actions">
      <a class="btn" id="repoLink" href="#" target="_blank" rel="noreferrer">GitHub 仓库</a>
      <a class="btn" id="dirLink" href="#" target="_blank" rel="noreferrer">打开 configs/ 目录</a>
    </div>
  </header>

  <input id="q" placeholder="过滤：输入关键字（比如 programA / prod / rules）" />

  <div class="statusline">
    <span class="pill" id="status">加载中…</span>
    <span class="meta">提示：点击 <b>Edit</b> 跳转到 GitHub 在线编辑；程序读取建议使用 <b>Raw</b>。</span>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width:45%;">路径</th>
        <th style="width:18%;">Pages</th>
        <th style="width:18%;">Raw</th>
        <th style="width:19%;">Edit</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

<script>
  // ====== 只改这里（2 行）======
  const OWNER = "hellokun985"; // GitHub owner/org
  const REPO  = "doc-yml";     // repo name
  // ============================

  const BRANCH = "main";
  const ROOT_DIR = "configs";

  // header/footer links (safe even if elements are parsed later)
  {
    const repoA = document.getElementById("repoLink");
    if (repoA) repoA.href = `https://github.com/${OWNER}/${REPO}`;

    const dirA = document.getElementById("dirLink");
    if (dirA) dirA.href = `https://github.com/${OWNER}/${REPO}/tree/${BRANCH}/${ROOT_DIR}`;

    const branchEl = document.getElementById("branchText");
    if (branchEl) branchEl.textContent = BRANCH;

    const dirEl = document.getElementById("dirText");
    if (dirEl) dirEl.textContent = ROOT_DIR + "/";
  }

  const statusEl = document.getElementById("status");
  const rowsEl = document.getElementById("rows");
  const qEl = document.getElementById("q");

  const ghApi = (path) => `https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}?ref=${encodeURIComponent(BRANCH)}`;
  const pagesBase = `https://${OWNER}.github.io/${REPO}/`;
  const rawBase = `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/`;
  const editBase = `https://github.com/${OWNER}/${REPO}/edit/${BRANCH}/`;

  function isYaml(name) {
    return name.endsWith(".yml") || name.endsWith(".yaml");
  }

  async function listDir(path) {
    const res = await fetch(ghApi(path));
    if (!res.ok) throw new Error(`GitHub API ${res.status}: ${await res.text()}`);
    const data = await res.json();
    return Array.isArray(data) ? data : [];
  }

  async function walk(path) {
    const items = await listDir(path);
    const out = [];
    for (const it of items) {
      if (it.type === "dir") {
        out.push(...await walk(it.path));
      } else if (it.type === "file" && isYaml(it.name)) {
        out.push(it.path);
      }
    }
    return out;
  }

  function render(paths) {
    const q = (qEl.value || "").trim().toLowerCase();
    const filtered = q ? paths.filter(p => p.toLowerCase().includes(q)) : paths;

    rowsEl.innerHTML = filtered.map(p => {
      const pagesUrl = pagesBase + p;
      const rawUrl = rawBase + p;
      const editUrl = editBase + p;
      return `
        <tr>
          <td><code>${p}</code></td>
          <td><a href="${pagesUrl}" target="_blank" rel="noreferrer">Open</a></td>
          <td><a href="${rawUrl}" target="_blank" rel="noreferrer">Raw</a></td>
          <td><a href="${editUrl}" target="_blank" rel="noreferrer">Edit</a></td>
        </tr>
      `;
    }).join("");

    statusEl.textContent = `共 ${paths.length} 个 YAML，显示 ${filtered.length} 个`;
  }

  (async () => {
    try {
      statusEl.textContent = "扫描中…";
      const paths = await walk(ROOT_DIR);
      paths.sort();
      window.__paths = paths;
      render(paths);
      qEl.addEventListener("input", () => render(window.__paths));
    } catch (e) {
      statusEl.textContent = "加载失败";
      rowsEl.innerHTML = `
        <tr><td colspan="4">
          <pre>${String(e)}</pre>
          <div class="meta">
            常见原因：仓库私有导致匿名访问失败；或 OWNER/REPO/分支名不是 main；或 configs/ 目录不存在。
          </div>
        </td></tr>`;
    }
  })();

  // Ensure footer texts are set after full parse
  window.addEventListener("load", () => {
    const branchEl = document.getElementById("branchText");
    if (branchEl) branchEl.textContent = BRANCH;
    const dirEl = document.getElementById("dirText");
    if (dirEl) dirEl.textContent = ROOT_DIR + "/";

    const dirA = document.getElementById("dirLink");
    if (dirA) dirA.href = `https://github.com/${OWNER}/${REPO}/tree/${BRANCH}/${ROOT_DIR}`;
  });
</script>
  <footer>
    <span>分支：<code id="branchText"></code></span>
    <span> · 目录：<code id="dirText"></code></span>
  </footer>
</body>
</html>
